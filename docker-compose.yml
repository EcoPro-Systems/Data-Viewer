version: "3"
services:
    backend:
        image: docker.osgeo.org/geoserver:2.24.x
        ports:
            - 8080:8080
        volumes:
            - ./geoserver_data:/opt/geoserver_data:rw
        environment:
            - ROOT_WEBAPP_REDIRECT=true
            - INSTALL_EXTENSIONS=true
            - SKIP_DEMO_DATA=true
            - STABLE_EXTENSIONS=netcdf,vectortiles,importer
            - COMMUNITY_EXTENSIONS=cog
            - CORS_ENABLED=true
        deploy:
            restart_policy:
                condition: on-failure
    
    frontend:
        build: ./common-mapping-client
        volumes:
            - ecopro_app:/usr/share/nginx/html/app:rw
            - ./nginx_logs:/var/log/nginx:rw
        ports:
            - 80:80
        restart: always
    
    ecoprodev:
        build: .
        volumes:
            - scripts:/ecopro/scripts
            - datafiles:/datafiles

volumes:
    ecopro_app:
        driver: local
        driver_opts:
            type: none
            o: bind
            device: ${PWD}/common-mapping-client_build
    datafiles:
        driver: local
        driver_opts:
            type: none
            o: bind
            device: ${PWD}/data_files
    scripts:
        driver: local
        driver_opts:
            type: none
            o: bind
            device: ${PWD}/scripts
            